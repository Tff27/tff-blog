@using Markdig;
@using Ganss.XSS;

@inject IHtmlSanitizer HtmlSanitizer

@markupInHtml

@code {
    private string markdown;

    private MarkupString markupInHtml;

    [Parameter]
    public string MarkdownContent
    {
        get => markdown;
        set
        {
            markdown = value;
            markupInHtml = ConvertStringToMarkupString(markdown);
        }
    }

    private MarkupString ConvertStringToMarkupString(string value)
    {
        if (!string.IsNullOrWhiteSpace(markdown))
        {
            var html = Markdig.Markdown.ToHtml(value, new MarkdownPipelineBuilder().UseAdvancedExtensions().Build());
            var sanitizedHtml = HtmlSanitizer.Sanitize(html);

            return new MarkupString(sanitizedHtml);
        }

        return new MarkupString();
    }
}